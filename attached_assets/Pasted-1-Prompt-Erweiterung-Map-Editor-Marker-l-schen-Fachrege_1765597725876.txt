1) Prompt-Erweiterung: Map-Editor Marker lÃ¶schen
Fachregel

Marker (Halle/Station/Stand) kÃ¶nnen gesetzt, verschoben und gelÃ¶scht werden.

LÃ¶schen bedeutet: Koordinaten entfernen, nicht EntitÃ¤t lÃ¶schen.

UI muss eine Sicherheitsabfrage haben.

Umsetzung

FÃ¼r Hallen: halls.location_meta.mapMarker = null (oder Feld lÃ¶schen)

FÃ¼r Stationen: stations.location_meta.x/y = null (oder entire location_meta entfernen)

FÃ¼r StÃ¤nde: stands.position_meta.x/y = null

2) Prompt-Erweiterung: Stationen global eindeutig (keine Duplikate wie K13-S01 & K18-S01)

Du beschreibst aktuell ein Muster wie:

K13 hat â€œStation 01â€

K18 hat â€œStation 01â€
â€¦nur mit anderem Code (oder identischem Pattern).

Wenn du willst, dass Stationen einmalig sind, gilt:

Neue Regel (zwingend)

stations.code ist global UNIQUE (nicht nur je Halle).

Eine Station wird verschoben, nicht â€œneu pro Halle angelegtâ€.

In UI wird nicht â€œK13-S01â€ als IdentitÃ¤t gefÃ¼hrt, sondern z. B.:

S01 oder STATION-01 (global)

und Halle ist nur Standort/Container.

DB-Migration (zwingend)
CREATE UNIQUE INDEX IF NOT EXISTS stations_code_uniq
ON public.stations(code);

Datenmigration (falls du bereits Duplikate hast)

Wenn es bereits doppelte Codes gibt, brauchst du entweder:

Codes vereinheitlichen (umbenennen), oder

eine Canonical-Station wÃ¤hlen und die anderen zusammenfÃ¼hren (Merge).

Da du aber sagst â€žes darf nicht seinâ€œ, ist das vermutlich ein Seed/Logik-Fehler und noch korrigierbar.

ðŸ”´ EXPERTENPROMPT (Copy/Paste) â€“ Marker lÃ¶schen + Station global eindeutig

Du kannst das direkt in Replit geben:

ðŸ”´ PROMPT START

Du bist Lead Engineer (NestJS + Postgres + Expo RN). Implementiere zwei Korrekturen: (1) Map-Editor Marker lÃ¶schen, (2) Stationen sind global eindeutig (keine Station-Duplikate pro Halle).

Teil A â€” Map Editor: Marker setzbar, verschiebbar UND lÃ¶schbar
UI

Im Admin â€žMap Editorâ€œ:

Marker (Halle/Station/Stand) sind anklickbar.

Beim Klick Ã¶ffnet sich ein kleines KontextmenÃ¼:

â€žVerschiebenâ€œ (Drag/Drop oder Klick-Neusetzen)

â€žLÃ¶schenâ€œ (nur Koordinaten lÃ¶schen)

â€žLÃ¶schenâ€œ erfordert Confirm Dialog:

â€žMarker wirklich lÃ¶schen? Die EntitÃ¤t bleibt bestehen.â€œ

Backend

Implementiere DELETE/PATCH Endpoints:

PATCH /admin/halls/:id/map-marker { x, y } // set

DELETE /admin/halls/:id/map-marker // delete -> set mapMarker null/remove

PATCH /admin/stations/:id/position { x, y }

DELETE /admin/stations/:id/position // delete -> remove x/y or set null

PATCH /admin/stands/:id/position { x, y }

DELETE /admin/stands/:id/position

Servervalidierung:

x,y nur im Bereich 0..1
Audit:

activity_logs type='MAP'

action: MAP_MARKER_SET / MAP_MARKER_DELETED

metadata enthÃ¤lt entityType, entityId, before/after

Teil B â€” Stationen global eindeutig (keine Station-01 pro Halle)
Fachregel

Eine Station ist ein global eindeutiges Objekt.

stations.code muss global UNIQUE sein.

Hallen-Zuordnung ist Standort (stations.hall_id) und kann geÃ¤ndert werden (Move).

Es darf nicht vorkommen, dass â€žStation 01â€œ mehrfach existiert (egal in welcher Halle).

DB

Erzeuge Unique Index:

CREATE UNIQUE INDEX IF NOT EXISTS stations_code_uniq
ON public.stations(code);


Entferne/ignoriere (hall_id, code) Constraint, falls vorhanden und redundant.

Backend

Create Station:

verweigere Duplikat code mit 409 Conflict

Move Station (hall_id Ã¤ndern):

kein neues Station-Objekt erzeugen, sondern Update stations.hall_id

In allen UI-Flows:

Auswahl â€žStationâ€œ ist global, danach wird Halle nur angezeigt/gewÃ¤hlt fÃ¼r Umzug

Data Repair / Migration Script (falls Seeds Duplikate erzeugt haben)

Schreibe ein Repair Script:

finde Duplikate nach stations.code

stoppe mit Fehler + Report, wenn Duplikate existieren

(optional) biete Merge-Funktion Ã¼ber Admin an (nicht automatisch ohne Freigabe)

UI Anpassung

In Layout-Verwaltung:

Stationen werden global gelistet

â€žStation verschieben nach Halleâ€œ Ã¤ndert nur hall_id

In Map:

Station marker ist an station_id gebunden; wenn Station umgezogen wird, erscheint sie nur in der neuen Halle

Output:

VollstÃ¤ndiger Code Backend+UI

Migrationen

README_STATIONS_UNIQUE.md + README_MAP_EDITOR.md